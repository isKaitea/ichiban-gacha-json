(function(){"use strict";var e={2639:function(e,i,r){var t=r(3751),s=r(641),n=r(33);const l={id:"app",class:"app"},a={class:"main"},o={key:0,class:"state"},c={key:1,class:"state error"},d={key:2,class:"content-layout"},u={class:"left-panel"},h={class:"preview-block"},p={class:"preview-box"},k={class:"preview-name"},v=["src","alt"],m={class:"preview-desc"},f={key:1,class:"placeholder"},g={key:0,class:"preview-nav"},b={class:"nav-info"},z={key:0,class:"series-info-block"},x={class:"series-header"},S={class:"series-title"},y=["disabled"],C={class:"series-meta"},L={key:0,class:"series-desc"},P={class:"right-panel"},w={class:"prize-list"},T=["onClick"],I={class:"prize-line"},_={class:"tier-bold"},E={class:"prize-text"},O={key:0,class:"prize-status"},Q={key:1,class:"prize-status"},X={class:"modal"},M={class:"modal-prize-tier"},j={class:"modal-prize-name"},R=["src","alt"],F={class:"modal-desc"},U={key:0,class:"modal-remain"};function D(e,i,r,D,A,K){return(0,s.uX)(),(0,s.CE)("div",l,[i[8]||(i[8]=(0,s.Lk)("header",{class:"site-header"},[(0,s.Lk)("h2",null,"一番賞抽獎網站（打版版）")],-1)),(0,s.Lk)("main",a,[A.loading?((0,s.uX)(),(0,s.CE)("section",o," 讀取中... ")):A.error?((0,s.uX)(),(0,s.CE)("section",c," 載入失敗："+(0,n.v_)(A.error),1)):((0,s.uX)(),(0,s.CE)("section",d,[(0,s.Lk)("section",u,[(0,s.Lk)("div",h,[(0,s.Lk)("div",p,[K.currentSlide?((0,s.uX)(),(0,s.CE)(s.FK,{key:0},[(0,s.Lk)("h4",k,(0,n.v_)(K.currentSlide.title),1),(0,s.Lk)("img",{class:"preview-img",src:K.currentSlide.imageUrl,alt:K.currentSlide.title},null,8,v),(0,s.Lk)("p",m,(0,n.v_)(K.currentSlide.description),1)],64)):((0,s.uX)(),(0,s.CE)("p",f," 資料載入有誤，請稍後再試 "))]),A.slides.length>1?((0,s.uX)(),(0,s.CE)("div",g,[(0,s.Lk)("button",{class:"nav-btn",onClick:i[0]||(i[0]=(...e)=>K.prevSlide&&K.prevSlide(...e))},"上一張"),(0,s.Lk)("span",b,(0,n.v_)(A.currentSlideIndex+1)+" / "+(0,n.v_)(A.slides.length),1),(0,s.Lk)("button",{class:"nav-btn",onClick:i[1]||(i[1]=(...e)=>K.nextSlide&&K.nextSlide(...e))},"下一張")])):(0,s.Q3)("",!0)]),A.series?((0,s.uX)(),(0,s.CE)("div",z,[(0,s.Lk)("div",x,[(0,s.Lk)("h1",S,(0,n.v_)(A.series.name),1),(0,s.Lk)("button",{class:"draw-btn header-draw-btn",onClick:i[2]||(i[2]=(...e)=>K.drawOnce&&K.drawOnce(...e)),disabled:!A.box||A.box.remainingTickets<=0}," 抽獎 ",8,y)]),(0,s.Lk)("p",C," 單抽："+(0,n.v_)(A.series.pricePerDraw)+" 元 ｜ 本盒總抽數： "+(0,n.v_)(A.box?A.box.totalTickets:0)+" 抽 ｜ 剩餘： "+(0,n.v_)(A.box?A.box.remainingTickets:0)+" 抽 ",1),A.series.description?((0,s.uX)(),(0,s.CE)("p",L,(0,n.v_)(A.series.description),1)):(0,s.Q3)("",!0)])):(0,s.Q3)("",!0)]),(0,s.Lk)("section",P,[i[6]||(i[6]=(0,s.Lk)("h3",null,"獎項清單",-1)),(0,s.Lk)("ul",w,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(A.prizeTiers,e=>((0,s.uX)(),(0,s.CE)("li",{key:e.id,class:(0,n.C4)(["prize-item",{selected:A.selectedPrize&&A.selectedPrize.id===e.id,soldout:K.isPrizeSoldOut(e)}]),onClick:i=>K.selectPrize(e)},[(0,s.Lk)("div",I,[(0,s.Lk)("strong",_,(0,n.v_)(e.tierCode)+"賞",1),(0,s.Lk)("span",E,(0,n.v_)(e.name),1)]),e.isLastPrize?((0,s.uX)(),(0,s.CE)("div",O,[(0,s.Lk)("span",null,(0,n.v_)(A.lastPrizeClaimed?"已獲得":"尚未開出"),1)])):((0,s.uX)(),(0,s.CE)("div",Q,[(0,s.Lk)("span",null," 剩餘 / 總數： "+(0,n.v_)(K.getRemainingQty(e.id))+" / "+(0,n.v_)(K.getTotalQty(e.id)),1)]))],10,T))),128))])])]))]),A.showResultModal&&A.currentPrize?((0,s.uX)(),(0,s.CE)("div",{key:0,class:"modal-backdrop",onClick:i[5]||(i[5]=(0,t.D$)((...e)=>K.closeModal&&K.closeModal(...e),["self"]))},[(0,s.Lk)("div",X,[(0,s.Lk)("button",{class:"modal-close",onClick:i[3]||(i[3]=(...e)=>K.closeModal&&K.closeModal(...e))}," × "),i[7]||(i[7]=(0,s.Lk)("h3",{class:"modal-title"},"本次抽獎結果",-1)),(0,s.Lk)("p",M,(0,n.v_)(A.currentPrize.tierCode)+"賞 ",1),(0,s.Lk)("p",j,(0,n.v_)(A.currentPrize.name),1),(0,s.Lk)("img",{class:"modal-img",src:A.currentPrize.imageUrl,alt:A.currentPrize.name},null,8,R),(0,s.Lk)("p",F,(0,n.v_)(A.currentPrize.description),1),A.box?((0,s.uX)(),(0,s.CE)("p",U," 本盒剩餘抽數："+(0,n.v_)(A.box.remainingTickets),1)):(0,s.Q3)("",!0),(0,s.Lk)("button",{class:"modal-ok",onClick:i[4]||(i[4]=(...e)=>K.closeModal&&K.closeModal(...e))}," 確認 ")])])):(0,s.Q3)("",!0)])}r(4114),r(8111),r(116),r(1701);var A={name:"App",data(){return{loading:!0,error:null,series:null,prizeTiers:[],box:null,slides:[],currentSlideIndex:0,selectedPrize:null,currentPrize:null,lastPrizeClaimed:!1,showResultModal:!1}},computed:{currentSlide(){return this.slides&&0!==this.slides.length?this.slides[this.currentSlideIndex]:null}},async created(){try{const t=await fetch("/data/gacha.json");if(!t.ok)throw new Error("HTTP "+t.status);const s=await t.json();this.series={id:s.series.id,name:s.series.name,pricePerDraw:s.series.pricePerDraw,description:s.series.description,bannerImage:s.series.bannerImage},this.prizeTiers=s.prizeTiers.map(function(e){return{id:e.id,tierCode:e.tierCode,name:e.name,imageUrl:e.imageUrl,description:e.description,isLastPrize:0===e.id||"最後賞"===e.tierCode||"string"===typeof e.tierCode&&-1!==e.tierCode.indexOf("最後")}}),this.box=s.box;var e=[];this.series.bannerImage&&e.push({id:"banner",type:"banner",title:this.series.name+" 主視覺",imageUrl:this.series.bannerImage,description:this.series.description,prizeId:null});for(var i=0;i<this.prizeTiers.length;i++){var r=this.prizeTiers[i];e.push({id:"prize-"+r.id,type:"prize",title:r.tierCode+"賞 "+r.name,imageUrl:r.imageUrl,description:r.description,prizeId:r.id})}this.slides=e,this.currentSlideIndex=0,this.updateSelectedFromSlide()}catch(t){this.error=t.message||String(t)}finally{this.loading=!1}},methods:{updateSelectedFromSlide(){var e=this.currentSlide;if(e&&"prize"===e.type){var i=this.prizeTiers.find(function(i){return i.id===e.prizeId});this.selectedPrize=i||null}else this.selectedPrize=null},prevSlide(){this.slides&&0!==this.slides.length&&(0===this.currentSlideIndex?this.currentSlideIndex=this.slides.length-1:this.currentSlideIndex=this.currentSlideIndex-1,this.updateSelectedFromSlide())},nextSlide(){this.slides&&0!==this.slides.length&&(this.currentSlideIndex===this.slides.length-1?this.currentSlideIndex=0:this.currentSlideIndex=this.currentSlideIndex+1,this.updateSelectedFromSlide())},selectPrize(e){if(this.selectedPrize=e,this.slides&&0!==this.slides.length){var i=this.slides.findIndex(function(i){return"prize"===i.type&&i.prizeId===e.id});i>=0&&(this.currentSlideIndex=i)}},getTotalQty(e){if(!this.box||!this.box.prizeStocks)return 0;var i=this.box.prizeStocks.find(function(i){return i.prizeTierId===e});return i?i.initialQty:0},getRemainingQty(e){if(!this.box||!this.box.prizeStocks)return 0;var i=this.box.prizeStocks.find(function(i){return i.prizeTierId===e});return i?i.remainingQty:0},isPrizeSoldOut(e){return e.isLastPrize?this.lastPrizeClaimed:0===this.getRemainingQty(e.id)},closeModal(){this.showResultModal=!1},drawOnce(){if(this.box)if(this.box.remainingTickets<=0)alert("這一盒已經抽完了");else{if(1===this.box.remainingTickets){var e=this.prizeTiers.find(function(e){return e.isLastPrize});return e?(this.currentPrize=e,this.lastPrizeClaimed=!0,this.box.remainingTickets=this.box.remainingTickets-1,this.showResultModal=!0,void this.selectPrize(e)):void alert("找不到最後賞資料")}if(this.box.prizeStocks&&0!==this.box.prizeStocks.length){for(var i=0,r=0;r<this.box.prizeStocks.length;r++){var t=this.box.prizeStocks[r].remainingQty;t>0&&(i+=t)}if(i<=0)return alert("一般賞庫存為 0，將進入最後賞階段"),void(this.box.remainingTickets=1);for(var s=Math.floor(Math.random()*i)+1,n=0,l=null,a=0;a<this.box.prizeStocks.length;a++){var o=this.box.prizeStocks[a];if(!(o.remainingQty<=0)&&(n+=o.remainingQty,s<=n)){l=o;break}}if(l){var c=this.prizeTiers.find(function(e){return e.id===l.prizeTierId});c?(l.remainingQty=l.remainingQty-1,this.box.remainingTickets=this.box.remainingTickets-1,this.currentPrize=c,this.showResultModal=!0,this.selectPrize(c)):alert("找不到對應獎項資料")}else alert("抽獎計算錯誤，請檢查庫存資料")}else alert("未設定獎項庫存")}}}},K=r(6262);const H=(0,K.A)(A,[["render",D]]);var $=H;(0,t.Ef)($).mount("#app")}},i={};function r(t){var s=i[t];if(void 0!==s)return s.exports;var n=i[t]={exports:{}};return e[t].call(n.exports,n,n.exports,r),n.exports}r.m=e,function(){var e=[];r.O=function(i,t,s,n){if(!t){var l=1/0;for(d=0;d<e.length;d++){t=e[d][0],s=e[d][1],n=e[d][2];for(var a=!0,o=0;o<t.length;o++)(!1&n||l>=n)&&Object.keys(r.O).every(function(e){return r.O[e](t[o])})?t.splice(o--,1):(a=!1,n<l&&(l=n));if(a){e.splice(d--,1);var c=s();void 0!==c&&(i=c)}}return i}n=n||0;for(var d=e.length;d>0&&e[d-1][2]>n;d--)e[d]=e[d-1];e[d]=[t,s,n]}}(),function(){r.d=function(e,i){for(var t in i)r.o(i,t)&&!r.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:i[t]})}}(),function(){r.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){r.o=function(e,i){return Object.prototype.hasOwnProperty.call(e,i)}}(),function(){var e={524:0};r.O.j=function(i){return 0===e[i]};var i=function(i,t){var s,n,l=t[0],a=t[1],o=t[2],c=0;if(l.some(function(i){return 0!==e[i]})){for(s in a)r.o(a,s)&&(r.m[s]=a[s]);if(o)var d=o(r)}for(i&&i(t);c<l.length;c++)n=l[c],r.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return r.O(d)},t=self["webpackChunkichiban_gacha_json"]=self["webpackChunkichiban_gacha_json"]||[];t.forEach(i.bind(null,0)),t.push=i.bind(null,t.push.bind(t))}();var t=r.O(void 0,[504],function(){return r(2639)});t=r.O(t)})();
//# sourceMappingURL=app.327a8caa.js.map